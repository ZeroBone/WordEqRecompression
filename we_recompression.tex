% \documentclass[handout]{beamer}
\documentclass{beamer}
\usepackage{lmodern}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}

\usepackage{amsmath, amsthm, amsfonts, amssymb}
\usepackage{mathrsfs}

\usepackage{oubraces}

\usepackage{tikz}

\usepackage[sanserif]{complexity}

% Algorithms
\usepackage[ruled]{algorithm2e}
\SetKw{Continue}{continue}

\usetheme{Madrid}
\usecolortheme{default}

\title[The recompression technique for WE]{The recompression technique for word equations}
\author{Alexander Mayorov}
\institute[RPTU]{University of Kaiserslautern--Landau (RPTU)}

% \newclass{\TWOEXP}{2EXPTIME}
\newclass{\THREENEXP}{3NEXPTIME}
\newclass{\FOURNEXP}{4NEXPTIME}
\renewclass{\EXP}{EXPTIME}
\renewclass{\NEXP}{NEXPTIME}

\def\Mstruct{\mathcal{M}}

\def\N{\mathbb{N}_{\ge 0}}
\def\Npos{\mathbb{N}_{\ge 1}}
\def\Nsimpl{\mathbb{N}}
\def\R{\mathbb{R}}
\def\Z{\mathbb{Z}}
\def\Q{\mathbb{Q}}
\def\P{\mathcal{P}}

\def\X{\mathcal{X}}

\newlang{\EUF}{EUF}

\DeclareMathOperator{\Disjuncts}{DNF}
\DeclareMathOperator{\DisjunctsOf}{DisjOf}

\def\DisjPhi{\Disjuncts(\varphi)}
\def\DisjPhiPrime{\Disjuncts(\varphi')}
\def\DisjNegPhi{\Disjuncts(\neg\varphi)}
\def\DisjTrue{\Disjuncts(\top)}

\DeclareMathOperator{\CDCL}{CDCL}
\def\CDCLT{\CDCL(\mathrm{T})}

\newcommand{\var}[1]{\textcolor{blue}{#1}}
\newcommand{\sol}[1]{\textcolor{orange}{#1}}

\definecolor{OliveGreen}{rgb}{0,0.6,0}
\definecolor{LightCyan}{rgb}{0.88,1,1}
\definecolor{magentazb}{RGB}{255,0,255}
\definecolor{LightBlueZB}{RGB}{51,51,179} % #3333B3

\newcommand{\freshVar}[1]{\textcolor{red}{#1}}
\newcommand{\anotherFreshVar}[1]{\textcolor{OliveGreen}{#1}}
\newcommand{\alertGreen}[1]{\textcolor{OliveGreen}{#1}}
\newcommand{\alertBlue}[1]{\textcolor{LightBlueZB}{#1}}

\newcommand{\stepdown}[1]{
	\begin{center}
		\begin{tabular}{c c}
			$ \Downarrow $ & #1
		\end{tabular}
	\end{center}
}

\newcommand{\unknowneqpart}[1]{\sol{\boxed{\mbox{#1}}}}
\newcommand{\redeqbox}[1]{\freshVar{\boxed{\mbox{#1}}}}

\newenvironment<>{openproblem}[1][]{%
	\setbeamercolor{block title}{fg=white,bg=magentazb}%
	\begin{block}#1}{\end{block}}

\begin{document}
	
\frame{\titlepage}

\begin{frame}
\frametitle{The problem}

Fix some finite alphabet $ \Gamma $ and set of variables $ \X $.

\begin{problem}[Satisfiability of word equations]
	Given an equation $ U = V $ where $ U, V \in (\Gamma \cup \X)^* $, does there exist a substitution $ \varphi : \X \rightarrow \Gamma^* $ satisfying the equation?
\end{problem}

\begin{example}[Satisfiable equation]
	The equation $ b\var{x}ba\var{y}b = \var{y}bb\var{x}ab $ is \alertGreen{satisfiable} via $ \varphi(\var{x}) := \sol{ab} $, $ \varphi(\var{y}) := \sol{ba} $: \begin{center}
		\begin{tabular}{c c c c c c c c c c}
			$ b $ & $ \var{x} $ & $ ba $ & $ \var{y} $ & $ b $ & $ = $ & $ \var{y} $ & $ bb $ & $ \var{x} $ & $ ab $ \\
			$ b $ & $ \sol{ab} $ & $ ba $ & $ \sol{ba} $ & $ b $ & $ = $ & $ \sol{ba} $ & $ bb $ & $ \sol{ab} $ & $ ab $
		\end{tabular}
	\end{center}
\end{example}

\begin{example}[Unsatisfiable equations]
	The equations $ a\var{x} = b\var{y} $, $ a\var{x}\var{y} = \var{y}a\var{x}a $ and $ \var{x}a = ab\var{x} $ are \alert{unsatisfiable}.
\end{example}

\end{frame}

\begin{frame}
\frametitle{History}

\begin{itemize}
	\item[1977] Word equations are decidable \cite{makanin:1977};
	\item[1990] Makanin's algorithm \cite{makanin:1977} improved to run in $ \FOURNEXP $ \cite{jaffar:1990, schulz:1990};
	\item[1996] Further improvement to $ \THREENEXP $ \cite{koscielski_pacholski:1996};
	\item[1998] Further improvement to $ \EXPSPACE $ \cite{gutierrez:1998};
	\item[1999] $ \NEXP $ algorithm via a double-exponential upper bound on the size of the length-minimal solution \cite{plandowski:1999};
	\item[2004] $ \PSPACE $ algorithm via a rewriting system \cite{plandowski:2004}. Soundness trivial, complicated proof of completeness;
	\item[2016] $ \PSPACE $ algorithm via the \textit{recompression technique} \cite{jez:2016};
	\item[2022] $ \NSPACE(n) $ algorithm via \textit{recompression} and Huffman coding \cite{jez:2022};
\end{itemize}

\pause

\textbf{Best known lower bound}: $ \NP $-hard

\begin{openproblem}{Long-standing open problem}
	Are word equations in $ \NP $?
\end{openproblem}

\end{frame}

\begin{frame}
	\frametitle{Notation}
	
	\begin{itemize}
		\item Consider the word equation $ ca\var{y}aa\var{x}a = \var{x}aaaca\var{y} $
		\item We visualize the solution \[
			\varphi(\var{x}) := \sol{cabcba}
			\quad\quad \varphi(\var{y}) := \sol{bcbaa}
		\] succinctly as follows: \[
		\overunderbraces{&&&\br{3}{\var{y}}&&&&\br{3}{\var{x}}}
		{&c\ a&\ &\sol{b\ c\ b\ a}&\ &a&\ &a\ a&\ &c\ a&\ &\sol{b\ c\ b\ a}&\ a}%
		{&\br{3}{\var{x}}&&&&&&&&\br{2}{\var{y}}}
		\]
		\item Over-braces encode the variables appearing on the left-hand side $ ca\var{y}aa\var{x}a $ of the equation, while the under-braces indicate the variables occuring on the right-hand side $ \var{x}aaaca\var{y} $
	\end{itemize}
	
\end{frame}

\begin{frame}
	\frametitle{Intuition: pair compression}
	
	\begin{columns}
		\column{0.5\textwidth}\textbf{Given equation}\[
		\overunderbraces{&&&\br{3}{\var{y}}&&&&\br{3}{\var{x}}}
		{&c\ a&\ &\unknowneqpart{?\ ?\ ?\ ?}&\ &a&\ &a\ a&\ &c\ a&\ &\unknowneqpart{?\ ?\ ?\ ?}&\ a}%
		{&\br{3}{\var{x}}&&&&&&&&\br{2}{\var{y}}}
		\]
		\column{0.5\textwidth}\textbf{Solved equation}\[
		\overunderbraces{&&&\br{3}{\var{y}}&&&&\br{3}{\var{x}}}
		{&c\ a&\ &\sol{b\ c\ b\ a}&\ &a&\ &a\ a&\ &c\ a&\ &\sol{b\ c\ b\ a}&\ a}%
		{&\br{3}{\var{x}}&&&&&&&&\br{2}{\var{y}}}
		\]
	\end{columns}
	\pause
	\stepdown{Compress $ \sol{ba} \rightsquigarrow \freshVar{d} $}
	\begin{columns}
		\column{0.5\textwidth}\[
		\overunderbraces{&&&\br{3}{\var{y}}&&&&\br{3}{\var{x}}}
		{&c\ a&\ &\unknowneqpart{?\ ?\ ?}&\ &a&\ &a\ a&\ &c\ a&\ &\unknowneqpart{?\ ?\ ?}&\ a}%
		{&\br{3}{\var{x}}&&&&&&&&\br{2}{\var{y}}}
		\]
		\column{0.5\textwidth}\[
		\overunderbraces{&&&\br{3}{\var{y}}&&&&\br{3}{\var{x}}}
		{&c\ a&\ &\sol{b\ c}\ \freshVar{d}&\ &a&\ &a\ a&\ &c\ a&\ &\sol{b\ c}\ \freshVar{d}&\ a}%
		{&\br{3}{\var{x}}&&&&&&&&\br{2}{\var{y}}}
		\]
	\end{columns}
	\pause
	\stepdown{Compress $ ca \rightsquigarrow \anotherFreshVar{e} $}
	\begin{columns}
		\column{0.5\textwidth}\[
		\overunderbraces{&&&\br{3}{\var{y}}&&&&\br{3}{\var{x}}}
		{&\anotherFreshVar{e}&\ &\unknowneqpart{?\ ?\ ?}&\ &a&\ &a\ a&\ &\anotherFreshVar{e}&\ &\unknowneqpart{?\ ?\ ?}&\ a}%
		{&\br{3}{\var{x}}&&&&&&&&\br{2}{\var{y}}}
		\]
		\column{0.5\textwidth}\[
		\overunderbraces{&&&\br{3}{\var{y}}&&&&\br{3}{\var{x}}}
		{&\anotherFreshVar{e}&\ &\sol{b\ c}\ \freshVar{d}&\ &a&\ &a\ a&\ &\anotherFreshVar{e}&\ &\sol{b\ c}\ \freshVar{d}&\ a}%
		{&\br{3}{\var{x}}&&&&&&&&\br{2}{\var{y}}}
		\]
	\end{columns}
\end{frame}

\begin{frame}
	\frametitle{Central idea}
	
	\textbf{Idea}: nondeterministically compress the given word equation $ U = V $ in a sound and complete way.
	
	\begin{center}
		\begin{tikzpicture}[
			grow=right,
			edge from parent/.style = {draw, -latex},
			sibling distance        = 2em,
			level distance          = 10em,
			]
			\node {$ U = V $}
			child {node {$ U_k = V_k $}}
			child {node {$ \phantom{U_k}\vdots\phantom{V_k} $}}
			child {node {$ U_3 = V_3 $}}
			child {node {$ U_2 = V_2 $}}
			child {node {$ U_1 = V_1 $}};
		\end{tikzpicture}
	\end{center}
	
	\begin{center}
		\begin{tabular}{r l c l}
			\alertBlue{Completeness}: & $ U = V $ \alertGreen{satisfiable} & $ \Rightarrow $ & $ \exists i : U_i = V_i $ \alertGreen{satisfiable} \\
			\alertBlue{Soundness}: & $ U = V $ \alert{unsatisfiable} & $ \Rightarrow $ & $ \forall i : U_i = V_i $ \alert{unsatisfiable}
		\end{tabular}
	\end{center}
\end{frame}

\begin{frame}
	\frametitle{Naive pair compression is problematic}
	
	Clearly, replacing $ ab $ by a fresh letter $ \freshVar{c} $ is sound. However, this operation is not always complete. Consider \alertGreen{satisfiable} equation \[
	\var{x}bab = ab\var{x}b
	\] with solution \[
	\overunderbraces{&\br{3}{\var{x}}}
	{&a\ b&\ &a&\ &b\ a&\ &b}%
	{&&&\br{3}{\var{x}}}
	\]\begin{columns}
		\column{0.5\textwidth}
		\stepdown{Compress $ ab \rightsquigarrow \freshVar{c} $}\[
		\var{x}b\freshVar{c} = \freshVar{c}\var{x}b
		\]\fbox{
			\parbox{0.9\textwidth}{
				\begin{center}
					\alert{Unsatisfiable}\\(because otherwise $ \varphi(\var{x})b \in c^* $)
				\end{center}
			}
		}
		\column{0.5\textwidth}
		\stepdown{Compress $ ba \rightsquigarrow \freshVar{c} $}\[
		\var{x}\freshVar{c}b = ab\var{x}b
		\]\fbox{
			\parbox{0.9\textwidth}{
				\begin{center}
					\alert{Unsatisfiable}\\(because $ |\var{x}\freshVar{c}b|_{\freshVar{c}} > |ab\var{x}b|_{\freshVar{c}} $)
				\end{center}
			}
		}
	\end{columns}
\end{frame}

\begin{frame}
	\frametitle{Crossing occurrences make compression not complete}
	
	\textbf{Problem}: We cannot replace $ \alertGreen{ab} $ by $ \freshVar{c} $ in \[
	\overunderbraces{&\br{3}{\var{x}}}
	{&a\ b&\ &\alertBlue{a}&\ &\alertBlue{b}\ \alertGreen{a}&\ &\alertGreen{b}}%
	{&&&\br{3}{\var{x}}}
	\] because $ ab $ has two crossing occurrences \alertBlue{ab} and \alertGreen{ab}, i.e., occurrences coming neither from $ U $ or $ V $ nor from $ \varphi(\var{x}) $ for some $ \var{x} $.
\end{frame}

\begin{frame}
	\frametitle{Crossing occurrences make compression not complete}
	
	\textbf{Solution}: Before compressing a pair $ ab $, ensure that $ ab $ has no crossing occurrences by ``popping-in'' letters from variables:
	
	\[
	\overunderbraces{&\br{3}{\var{x}}}
	{&a\ b&\ &\alertBlue{a}&\ &\alertBlue{b}\ \alertGreen{a}&\ &\alertGreen{b}}%
	{&&&\br{3}{\var{x}}}
	\]\stepdown{Set $ \var{x} := \var{x}a $}\[
	\overunderbraces{&\br{1}{\var{x}}}
	{&a\ b&\ &\alertBlue{a\ b}&\ &\alertGreen{a\ b}}%
	{&&&\br{1}{\var{x}}}
	\]\stepdown{Compress $ ab \rightsquigarrow \freshVar{c} $}\[
	\overunderbraces{&\br{1}{\var{x}}}
	{&\freshVar{c}&\ &\freshVar{c}&\ &\freshVar{c}}%
	{&&&\br{1}{\var{x}}}
	\]
	
	\begin{center}
		$ ab $ has no crossing occurrences $ \Rightarrow $ \alertBlue{sound} and \alertBlue{complete} transformation
	\end{center}
\end{frame}

\begin{frame}
	\frametitle{Pair compression algorithm}
	
	\begin{algorithm}[H]
		\caption{Pair compression}
		\SetAlgoLined
		\SetKwFunction{compresspair}{compress\_pair}
		\SetKwProg{compresspairproc}{Function}{}{end}
		\KwIn{Letters $ a, b \in \Gamma $}
		\compresspairproc{\compresspair{$ a $, $ b $}}{
			\nl Replace every $ ab $ appearing in $ U $ or $ V $ by a fresh letter $ \freshVar{c} $\;
		}
	\end{algorithm}
\end{frame}

\begin{frame}
	\frametitle{Popping algorithm}
	
	\begin{algorithm}[H]
		\caption{Popping and pair compression}
		\SetAlgoLined
		\SetKwFunction{pop}{pop}
		\SetKwProg{popproc}{Function}{}{end}
		\KwIn{Blocks $ \Gamma_l $ and $ \Gamma_r $ of a partition $ \Gamma = \Gamma_l \cup \Gamma_r $}
		\popproc{\pop{$ \Gamma_l $, $ \Gamma_r $}}{
			\nl \ForEach{$ \var{x} \in \X $}{
				\nl Let $ b $ be the first letter of $ \varphi(\var{x}) $\;
				\nl \If{$ b \in \Gamma_r $}{
					\nl Replace $ \var{x} $ either by $ b\var{x} $ or by $ b $\;
				}
				\nl Let $ a $ be the last letter of $ \varphi(\var{x}) $\;
				\nl \If{$ a \in \Gamma_l $}{
					\nl Replace $ \var{x} $ either by $ \var{x}a $ or by $ a $\;
				}
			}
		}
	\end{algorithm}
\end{frame}

\begin{frame}
	\frametitle{Block compression}
	
	\begin{itemize}
		\item We have discussed how to compress $ ab \in \Gamma^2 $ for $ a \neq b $.
		\item But what about blocks $ a^k $ for $ k \ge 1 $?
		\item We show that $ a^k $ can be compressed using an analogous approach.
	\end{itemize}

	\vspace{2em}
	
	\begin{center}
		\begin{tabular}{r|l}
			\textbf{Step 1} & \begin{tabular}{@{}l@{}}
				For all occurrences of $ a^k $ in $ \varphi(U) $ for $ k $ maximal,\\
				ensure that $ a^k $ is not crossing.
			\end{tabular}\\\hline
			\textbf{Step 2} & Replace every occurrence of $ a^k $ by a fresh letter $ a_k $.
		\end{tabular}
	\end{center}
\end{frame}

\begin{frame}
	\frametitle{Block compression: intuition}
	
	\only<1-5|handout:1-5>{\[
		\overunderbraces{&&&\br{3}{\var{y}}&&&&\br{3}{\var{x}}}
		{&\sol{c\ a}&\ &\sol{b\ c\ b\ a}&\ &a&\ &a\ a&\ &\sol{c\ a}&\ &\sol{b\ c\ b\ a}&\ a}%
		{&\br{3}{\var{x}}&&&&&&&&\br{2}{\var{y}}}
	\]}\only<1-5|handout:1-5>{\stepdown{Set $ \var{x} := \sol{c}\var{x}\sol{a} $}}\only<2|handout:2>{\[
		\overunderbraces{&&&&&\br{5}{\var{y}}&&&&&&\br{3}{\var{x}}}
		{&\sol{c}&\ &\sol{a}&\ &\sol{b}\ \sol{c}\ \sol{b}&\ &\sol{a}&\ &a&\ &a\ a&\ &\sol{c}&\ &\sol{a}&\ &\sol{b\ c\ b}&\ &\sol{a}&\ &a}%
		{&&&\br{3}{\var{x}}&&&&&&&&&&&&\br{5}{\var{y}}}
		\]
	}\only<3-|handout:3->{\[
		\overunderbraces{&&&&&\br{5}{\var{y}}&&&&&&\br{3}{\var{x}}}
		{&c&\ &a&\ &\sol{b}\ \sol{c}\ \sol{b}&\ &\sol{a}&\ &\sol{a}&\ &a\ a&\ &c&\ &a&\ &\sol{b\ c\ b}&\ &\sol{a}&\ &\sol{a}}%
		{&&&\br{3}{\var{x}}&&&&&&&&&&&&\br{5}{\var{y}}}
		\]
	}\only<4-|handout:4->{\stepdown{Set $ \var{y} := \sol{b}\var{y}\sol{aa} $}}\only<4|handout:4>{\[
		\overunderbraces{&&&&&&&\br{1}{\var{y}}&&&&&&&&&&\br{5}{\var{x}}}
		{&c&\ &a&\ &\sol{b}&\ &\sol{c}\ \sol{b}&\ &\sol{a}&\ &\sol{a}&\ &a\ a&\ &c&\ &a&\ &\sol{b}&\ &\sol{c\ b}&\ &\sol{a}&\ &\sol{a}}%
		{&&&\br{5}{\var{x}}&&&&&&&&&&&&&&\br{1}{\var{y}}}
	\]}\only<5-|handout:5->{\[
	\overunderbraces{&&&&&&&\br{1}{\var{y}}&&&&&&\br{5}{\var{x}}}
	{&c&\ &a&\ &b&\ &c\ b&\ &\redeqbox{a\ a\ a\ a}&\ &c&\ &a&\ &b&\ &c\ b&\ &a&\ &a}%
	{&&&\br{5}{\var{x}}&&\br{1}{\substack{\text{Block is no}\\\text{longer crossing}}}&&&&&&&&\br{1}{\var{y}}}
	\]}\only<6-|handout:6->{\stepdown{Compress $ \redeqbox{a\ a\ a\ a} \rightsquigarrow \freshVar{a_4} $}}\only<6-|handout:6->{\[
	\overunderbraces{&&&&&&&\br{1}{\var{y}}&&&&&&\br{5}{\var{x}}}
	{&c&\ &a&\ &b&\ &c\ b&\ &\freshVar{a_4}&\ &c&\ &a&\ &b&\ &c\ b&\ &a&\ &a}%
	{&&&\br{5}{\var{x}}&&&&&&&&&&\br{1}{\var{y}}}
	\]}
\end{frame}

\begin{frame}
	\frametitle{Block compression: intuition (continued)}
	
	\only<1>{\[
		\overunderbraces{&&&&&&&\br{1}{\var{y}}&&&&&&\br{5}{\var{x}}}
		{&c&\ &a&\ &b&\ &c\ b&\ &\freshVar{a_4}&\ &c&\ &a&\ &b&\ &c\ b&\ &a&\ &a}%
		{&&&\br{5}{\var{x}}&&&&&&&&&&\br{1}{\var{y}}}
		\]
	}\only<2->{\[
		\overunderbraces{&&&&&&&\br{1}{\var{y}}&&&&&&\br{5}{\var{x}}}
		{&c&\ &a&\ &b&\ &c\ b&\ &\freshVar{a_4}&\ &c&\ &a&\ &b&\ &c\ b&\ &\redeqbox{a\ a}}%
		{&&&\br{5}{\var{x}}&&&&&&&&&&\br{1}{\var{y}}}
		\]
	}\only<3->{\stepdown{Compress $ \redeqbox{a\ a} \rightsquigarrow \freshVar{a_2} $}}\only<3->{\[
		\overunderbraces{&&&&&&&\br{1}{\var{y}}&&&&&&\br{5}{\var{x}}}
		{&c&\ &a&\ &b&\ &c\ b&\ &\freshVar{a_4}&\ &c&\ &a&\ &b&\ &c\ b&\ &\freshVar{a_2}}%
		{&&&\br{5}{\var{x}}&&&&&&&&&&\br{1}{\var{y}}}
		\]
	}
	\only<3->{\begin{center}
		This concludes the compression of all $ a $-blocks.
	\end{center}}
\end{frame}

\begin{frame}
	\frametitle{Block compression}
	
	TODO
\end{frame}

\begin{frame}[allowframebreaks]
\frametitle{References}
\bibliographystyle{amsalpha}
\bibliography{we_recompression}
\end{frame}

\end{document}